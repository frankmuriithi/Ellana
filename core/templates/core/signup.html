{% extends 'core/base.html' %}
{% load static %}
{% block title %}Sign Up{% endblock %}




{% block content %}
<div class="auth-container">
    <div class="auth-card">
        <div class="auth-header">
            <h1 class="auth-title">Join Our Community</h1>
            <p class="auth-subtitle">Create your account to get started</p>
        </div>

        <form method="post" class="auth-form" id="authSignupForm">
            {% csrf_token %}
            
            <!-- Username Field -->
            <div class="auth-form-group">
                <label class="auth-form-label" for="auth_username">
                    <i class="fas fa-user" style="margin-right: 8px;"></i>
                    Username
                </label>
                <input type="text" name="username" id="auth_username" class="auth-form-input" 
                       placeholder="Choose a username" autocomplete="username" required>
                <ul class="auth-error-list" id="auth_username_errors"></ul>
            </div>

            <!-- Email Field -->
            <div class="auth-form-group">
                <label class="auth-form-label" for="auth_email">
                    <i class="fas fa-envelope" style="margin-right: 8px;"></i>
                    Email (optional)
                </label>
                <input type="email" name="email" id="auth_email" class="auth-form-input" 
                       placeholder="Your email address" autocomplete="email">
                <ul class="auth-error-list" id="auth_email_errors"></ul>
            </div>

            <!-- Password1 Field -->
            <div class="auth-form-group">
                <label class="auth-form-label" for="auth_password1">
                    <i class="fas fa-lock" style="margin-right: 8px;"></i>
                    Password
                </label>
                <input type="password" name="password1" id="auth_password1" class="auth-form-input" 
                       placeholder="Create a strong password" autocomplete="new-password" required>
                <button type="button" class="auth-password-toggle" id="auth_toggle_password1">
                    <i class="fas fa-eye"></i>
                </button>
                <ul class="auth-error-list" id="auth_password1_errors"></ul>
            </div>

            <!-- Password2 Field -->
            <div class="auth-form-group">
                <label class="auth-form-label" for="auth_password2">
                    <i class="fas fa-lock" style="margin-right: 8px;"></i>
                    Confirm Password
                </label>
                <input type="password" name="password2" id="auth_password2" class="auth-form-input" 
                       placeholder="Confirm your password" autocomplete="new-password" required>
                <button type="button" class="auth-password-toggle" id="auth_toggle_password2">
                    <i class="fas fa-eye"></i>
                </button>
                <ul class="auth-error-list" id="auth_password2_errors"></ul>
            </div>

            <button type="submit" class="auth-form-submit">
                <i class="fas fa-user-plus" style="margin-right: 8px;"></i>
                Create Account
            </button>

            <div class="auth-alternative">
                Already have an account? <a href="{% url 'login' %}">Sign in</a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('authSignupForm');
        const passwordToggle1 = document.getElementById('auth_toggle_password1');
        const passwordToggle2 = document.getElementById('auth_toggle_password2');
        const passwordField1 = document.getElementById('auth_password1');
        const passwordField2 = document.getElementById('auth_password2');
        
        // Password visibility toggle
        function setupPasswordToggle(toggleButton, passwordField) {
            toggleButton.addEventListener('click', function() {
                const type = passwordField.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordField.setAttribute('type', type);
                
                // Toggle eye icon
                const icon = this.querySelector('i');
                if (type === 'text') {
                    icon.classList.remove('fa-eye');
                    icon.classList.add('fa-eye-slash');
                } else {
                    icon.classList.remove('fa-eye-slash');
                    icon.classList.add('fa-eye');
                }
            });
        }
        
        setupPasswordToggle(passwordToggle1, passwordField1);
        setupPasswordToggle(passwordToggle2, passwordField2);
        
        // Real-time validation
        const fields = {
            'username': document.getElementById('auth_username'),
            'email': document.getElementById('auth_email'),
            'password1': document.getElementById('auth_password1'),
            'password2': document.getElementById('auth_password2')
        };
        
        // Add input event listeners for real-time validation
        for (const [fieldName, field] of Object.entries(fields)) {
            if (field) {
                field.addEventListener('input', function() {
                    this.classList.remove('error');
                    const errorElement = document.getElementById(`auth_${fieldName}_errors`);
                    if (errorElement) {
                        errorElement.classList.remove('show');
                    }
                });
            }
        }
        
        // Password strength indicator (could be enhanced further)
        passwordField1.addEventListener('input', function() {
            const value = this.value;
            if (value.length > 0) {
                if (value.length < 8) {
                    showFieldError('password1', ['Password should be at least 8 characters long.']);
                } else {
                    clearFieldError('password1');
                }
            }
        });
        
        // Confirm password validation
        passwordField2.addEventListener('input', function() {
            if (passwordField1.value !== this.value && this.value.length > 0) {
                showFieldError('password2', ['Passwords do not match.']);
            } else {
                clearFieldError('password2');
            }
        });
        
        // Form submission handling
        form.addEventListener('submit', function(e) {
            let hasErrors = false;
            
            // Basic validation
            if (!fields.username.value.trim()) {
                showFieldError('username', ['Username is required.']);
                hasErrors = true;
            }
            
            if (!fields.password1.value) {
                showFieldError('password1', ['Password is required.']);
                hasErrors = true;
            } else if (fields.password1.value.length < 8) {
                showFieldError('password1', ['Password should be at least 8 characters long.']);
                hasErrors = true;
            }
            
            if (!fields.password2.value) {
                showFieldError('password2', ['Please confirm your password.']);
                hasErrors = true;
            } else if (fields.password1.value !== fields.password2.value) {
                showFieldError('password2', ['Passwords do not match.']);
                hasErrors = true;
            }
            
            if (hasErrors) {
                e.preventDefault();
                // Scroll to first error
                const firstError = document.querySelector('.auth-form-input.error');
                if (firstError) {
                    firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        });
        
        function showFieldError(fieldName, messages) {
            const field = fields[fieldName];
            const errorElement = document.getElementById(`auth_${fieldName}_errors`);
            
            if (field && errorElement) {
                field.classList.add('error');
                errorElement.innerHTML = '';
                
                messages.forEach(message => {
                    const li = document.createElement('li');
                    li.textContent = message;
                    errorElement.appendChild(li);
                });
                
                errorElement.classList.add('show');
            }
        }
        
        function clearFieldError(fieldName) {
            const field = fields[fieldName];
            const errorElement = document.getElementById(`auth_${fieldName}_errors`);
            
            if (field && errorElement) {
                field.classList.remove('error');
                errorElement.classList.remove('show');
            }
        }
    });
</script>
{% endblock %}