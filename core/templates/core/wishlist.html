{% extends 'core/base.html' %}
{% load static %}

{% block content %}
<div class="wishlist-page">
    <div class="wishlist-header">
        <h1><i class="fas fa-heart"></i> Your Wishlist</h1>
        <span class="item-count">{{ wishlist_items.count }} items</span>
    </div>

    <div class="wishlist-items-container">
        {% if wishlist_items %}
        <div class="wishlist-grid">
            {% for item in wishlist_items %}
            <div class="wishlist-item" data-item-id="{{ item.outfit.id }}">
                <div class="item-image">
                    <img src="{{ item.outfit.image.url }}" alt="{{ item.outfit.name }}">
                    <button class="remove-wishlist" data-outfit-id="{{ item.outfit.id }}">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="item-details">
                    <h3 class="item-name">{{ item.outfit.name }}</h3>
                    <p class="item-price">Ksh{{ item.outfit.price }}</p>
                    <div class="item-actions">
                        <form method="post" action="{% url 'add_to_cart' item.outfit.id %}">
                            {% csrf_token %}
                            <button class="btn add-to-cart" data-outfit-id="{{ item.outfit.id }}">Add to Cart</button>
                        </form>
                        <button class="btn compare-btn" data-outfit-id="{{ item.outfit.id }}">Compare</button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-wishlist">
            <i class="far fa-heart"></i>
            <h3>Your wishlist is empty</h3>
            <p>Save your favorite items here</p>
            <a href="{% url 'outfit_list' %}" class="btn primary-btn">Continue Shopping</a>
        </div>
        {% endif %}
    </div>
</div>

<script>
    // Add to Compare
    document.querySelectorAll(".compare-btn").forEach(button => {
        button.addEventListener("click", function () {
            let outfitId = this.dataset.outfitId;

            fetch("{% url 'add_to_compare' %}", {
                method: "POST",
                headers: {
                    "X-CSRFToken": "{{ csrf_token }}",
                    "Content-Type": "application/x-www-form-urlencoded"
                },
                body: `outfit_id=${outfitId}`
            })
            .then(res => res.json())
            .then(data => alert(data.message));
        });
    });

    // Remove from Wishlist
document.addEventListener("DOMContentLoaded", function() {
    document.querySelectorAll(".remove-wishlist").forEach(button => {
        button.addEventListener("click", function(e) {
            e.preventDefault();
            let outfitId = this.getAttribute("data-outfit-id");

            fetch(`/wishlist/remove/${outfitId}/`, {
                method: "POST",
                headers: {
                    "X-CSRFToken": "{{ csrf_token }}",
                },
            })
            .then(response => {
                if (response.ok) {
                    // Remove the outfit card from DOM
                    this.closest(".item-image").parentElement.remove();
                }
            })
            .catch(error => console.error("Error:", error));
        });
    });
});


</script>

{% endblock %}