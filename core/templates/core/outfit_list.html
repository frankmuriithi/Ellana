{% extends 'core/base.html' %}
{% load static %}

{% block title %}Discover African Fashion | FashionHub{% endblock %}

{% block content %}

<style>
  /* Reviews Section Styles */
.reviews-section {
  padding: 5rem 0;
  background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
  position: relative;
  overflow: hidden;
}

.reviews-section::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path fill="rgba(0,0,0,0.02)" d="M0,0 L100,0 L100,100 L0,100 Z" /></svg>');
  opacity: 0.1;
  z-index: 0;
}

.container {
  position: relative;
  z-index: 1;
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
}

.section-title {
  text-align: center;
  font-size: 2.75rem;
  margin-bottom: 1rem;
  font-weight: 700;
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: gradientShift 8s ease infinite;
  background-size: 200% 200%;
}

.section-subtitle {
  text-align: center;
  font-size: 1.25rem;
  color: #64748b;
  margin-bottom: 3rem;
  font-weight: 400;
}

.reviews-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 30px;
  margin-bottom: 50px;
}

.review-card {
  background: white;
  border-radius: 16px;
  padding: 30px;
  box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.05);
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  position: relative;
  overflow: hidden;
  border: 1px solid rgba(0, 0, 0, 0.03);
}

.review-card::after {
  content: "\"";  /* Fixed quote escaping */
  position: absolute;
  top: 20px;
  right: 20px;
  font-size: 5rem;
  color: rgba(79, 70, 229, 0.03);
  font-family: serif;
  line-height: 1;
  z-index: 0;
  opacity: 0.8;  /* Added for better visibility control */
}

.review-card:hover {
  transform: translateY(-10px);
  box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.1);
}

.reviewer-info {
  display: flex;
  align-items: center;
  margin-bottom: 20px;
  position: relative;
  z-index: 1;
}

.reviewer-avatar {
  width: 56px;
  height: 56px;
  border-radius: 50%;
  object-fit: cover;
  margin-right: 15px;
  border: 3px solid rgba(79, 70, 229, 0.1);
  transition: all 0.3s ease;
}

.review-card:hover .reviewer-avatar {
  transform: scale(1.1);
  border-color: rgba(79, 70, 229, 0.3);
}

.reviewer-info h4 {
  font-size: 1.1rem;
  margin: 0;
  color: #1e293b;
}

.rating-stars {
  color: #fbbf24;
  font-size: 1.1rem;
  margin-top: 5px;
  letter-spacing: 2px;
}

.review-text {
  color: #475569;
  line-height: 1.7;
  font-size: 1rem;
  margin-bottom: 20px;
  position: relative;
  z-index: 1;
  font-style: italic;
}

.review-date {
  color: #94a3b8;
  font-size: 0.85rem;
  position: relative;
  z-index: 1;
}

.review-cta {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-top: 30px;
  flex-wrap: wrap;
}

.btn {
  padding: 14px 28px;
  border-radius: 12px;
  font-weight: 600;
  text-decoration: none;
  transition: all 0.3s ease;
  font-size: 1rem;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  position: relative;
  overflow: hidden;
}

.btn::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(255, 255, 255, 0.1);
  transform: translateX(-100%);
  transition: transform 0.4s ease;
}

.btn:hover::before {
  transform: translateX(0);
}

.btn-primary {
  background-color: #4f46e5;
  color: white;
  box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.2), 0 2px 4px -1px rgba(79, 70, 229, 0.1);
}

.btn-primary:hover {
  background-color: #4338ca;
  transform: translateY(-3px);
  box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.3), 0 4px 6px -2px rgba(79, 70, 229, 0.15);
}

.btn-outline {
  border: 2px solid #4f46e5;
  color: #4f46e5;
  background: transparent;
  transition: all 0.3s ease;
}

.btn-outline:hover {
  background-color: #4f46e5;
  color: white;
  transform: translateY(-3px);
  box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.1), 0 4px 6px -2px rgba(79, 70, 229, 0.05);
}

/* Animations */
@keyframes gradientShift {
  0% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
  100% {
    background-position: 0% 50%;
  }
}

/* Responsive Adjustments */
@media (max-width: 768px) {
  .reviews-grid {
    grid-template-columns: 1fr;
  }
  
  .section-title {
    font-size: 2rem;
  }
  
  .review-cta {
    flex-direction: column;
    align-items: center;
  }
  
  .btn {
    width: 100%;
    max-width: 300px;
  }
}

/* Micro-interactions */
.review-card:hover .rating-stars {
  animation: starPulse 0.6s ease;
}

@keyframes starPulse {
  0%, 100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.2);
  }
}
</style>

<!-- Hero Section with Parallax Effect -->
<section class="hero-section">
  <div class="hero-slideshow">
    <div class="slide active slide-1">
      <div class="hero-content">
        <h1 class="hero-title">Elevate Your Style</h1>
        <p class="hero-subtitle">Discover Authentic African Fashion</p>
        <a href="#featured" class="hero-btn pulse">Shop Now</a>
      </div>
    </div>
    <div class="slide slide-2">
      <div class="hero-content">
        <h1 class="hero-title">New Collection</h1>
        <p class="hero-subtitle">Handcrafted with Cultural Heritage</p>
        <a href="#featured" class="hero-btn pulse">Explore</a>
      </div>
    </div>
    <div class="slide slide-3">
      <div class="hero-content">
        <h1 class="hero-title">Summer Special</h1>
        <p class="hero-subtitle">Up to 40% Off Selected Items</p>
        <a href="#featured" class="hero-btn pulse">View Offers</a>
      </div>
    </div>
  </div>
  <div class="slide-dots"></div>
</section>

<!-- Featured Categories Section -->
<section class="categories-section">
  <div class="container">
    <h2 class="section-title animate-on-scroll">Shop by Category</h2>
    <div class="category-select-container">
      <div class="select-wrapper">
        <select id="category-select" class="modern-select" onchange="location = this.value;">
          <option value="">-- Select Category --</option>
          {% for category in categories %}
          <option value="{% url 'category_detail' category.slug %}">
            {{ category.name }}
          </option>
          {% endfor %}
        </select>
        <div class="select-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Main Outfits Section -->
<section class="outfits-section" id="featured">
  <div class="container">
    <div class="section-header">
      <h1 class="section-title animate-on-scroll">Our Collection</h1>
      <p class="section-subtitle animate-on-scroll">Handcrafted African designs for every occasion</p>
    </div>

    <!-- Enhanced Filter Bar -->
    <div class="filter-bar animate-on-scroll">
      <div class="filter-group">
        <div class="filter-toggle">
          <i class="fas fa-sliders-h"></i>
          <span>Filters</span>
        </div>
        <div class="filter-dropdown">
          <div class="filter-option">
            <label for="category-filter">Category:</label>
            <select id="category-filter" class="filter-select">
              <option value="all">All Categories</option>
              {% for category in categories %}
              <option value="{{ category.slug }}">{{ category.name }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="filter-option">
            <label for="sort-by">Sort by:</label>
            <select id="sort-by" class="filter-select">
              <option value="newest">Newest First</option>
              <option value="price-low">Price: Low to High</option>
              <option value="price-high">Price: High to Low</option>
              <option value="popular">Most Popular</option>
            </select>
          </div>
          <div class="filter-option">
            <label for="price-range">Price Range:</label>
            <div class="range-slider">
              <input type="range" min="0" max="10000" value="10000" class="slider" id="price-range">
              <span class="price-range-value">Up to Ksh 10,000</span>
            </div>
          </div>
        </div>
      </div>
      <div class="view-toggle">
        <button class="view-option active" data-view="grid"><i class="fas fa-th"></i></button>
        <button class="view-option" data-view="list"><i class="fas fa-list"></i></button>
      </div>
    </div>

    <!-- Outfits Grid/List View -->
    <div class="outfits-container view-grid">
      {% for outfit in outfits %}
      <div class="outfit-card" data-category="{{ outfit.category.slug }}" data-price="{{ outfit.price }}">
        <a href="{% url 'outfit_detail' outfit.pk %}" class="outfit-link">
          <div class="outfit-image-container">
            {% if outfit.image %}
            <img src="{{ outfit.image.url }}" alt="{{ outfit.name }}" class="outfit-image">
            {% else %}
            <img src="{% static 'images/placeholder.jpg' %}" alt="No image available" class="outfit-image">
            {% endif %}
            <div class="outfit-overlay">
              <button class="quick-view-btn">Quick View</button>
            </div>
            {% if outfit.is_new %}
            <span class="new-badge">New</span>
            {% endif %}
            {% if outfit.discount_percentage %}
            <span class="discount-badge">-{{ outfit.discount_percentage }}%</span>
            {% endif %}
          </div>
          <div class="outfit-info">
            <h3 class="outfit-name">{{ outfit.name }}</h3>
            <p class="outfit-designer">By {{ outfit.designer.user.username }}</p>
            <div class="outfit-meta">
              <div class="outfit-price">
                <span class="current-price">Ksh {{ outfit.price }}</span>
                {% if outfit.old_price %}
                <span class="old-price">Ksh {{ outfit.old_price }}</span>
                {% endif %}
              </div>
              <div class="outfit-rating">
                <i class="fas fa-star"></i>
                <span>4.8</span>
              </div>
            </div>
          </div>
        </a>
        <div class="outfit-actions">
          <form method="post" action="{% url 'add_to_cart' outfit.id %}">
            {% csrf_token %}
            <button class="add-to-cart-btn"  data-outfit-id="{{ outfit.id }}" >
              <i class="fas fa-shopping-bag"></i> Add to Cart
          </button>
          </form>
          <button class="wishlist-btn" data-outfit-id="{{ outfit.id }}">
            <i class="far fa-heart"></i>
          </button>
          <button class="compare-btn" data-outfit-id="{{ outfit.id }}">
            <i class="fas fa-exchange-alt"></i>
            <span class="compare-counter">{{ request.user.compare_items.count }}</span>
          </button>
        </div>
      </div>
      {% empty %}
      <div class="no-outfits">
        <img src="{% static 'images/empty-collection.svg' %}" alt="No outfits available" class="empty-icon">
        <h3>No outfits available yet</h3>
        <p>Check back soon for our latest collections</p>
        {% if user.is_superuser %}
        <a href="{% url 'add_outfit' %}" class="add-outfit-btn">Add Your First Outfit</a>
        {% endif %}
      </div>
      {% endfor %}
    </div>

    <!-- Pagination -->
    {% if is_paginated %}
    <div class="pagination animate-on-scroll">
      {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}" class="page-link">
        <i class="fas fa-chevron-left"></i> Previous
      </a>
      {% endif %}
      
      <div class="page-numbers">
        {% for num in page_obj.paginator.page_range %}
        {% if page_obj.number == num %}
        <span class="current-page">{{ num }}</span>
        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
        <a href="?page={{ num }}" class="page-link">{{ num }}</a>
        {% endif %}
        {% endfor %}
      </div>
      
      {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}" class="page-link">
        Next <i class="fas fa-chevron-right"></i>
      </a>
      {% endif %}
    </div>
    {% endif %}
  </div>
</section>


<!-- Reviews Section -->
<section class="reviews-section">
  <div class="container">
    <h2 class="section-title">What Our Customers Say</h2>
    <p class="section-subtitle">Trusted by thousands of satisfied users</p>
    
    <div class="reviews-grid">
      <!-- Review Card 1 -->
      <div class="review-card">
        <div class="reviewer-info">
          <img src="{% static 'images/hero2.jpg' %}" alt="User" class="reviewer-avatar">
          <div>
            <h4>Alex Johnson</h4>
            <div class="rating-stars">★★★★★</div>
          </div>
        </div>
        <p class="review-text">"This service completely transformed my workflow. The quality is outstanding and the support team is incredibly responsive."</p>
        <div class="review-date">Posted on March 15, 2023</div>
      </div>
      
      <!-- Review Card 2 -->
      <div class="review-card">
        <div class="reviewer-info">
          <img src="{% static 'images/hero2.jpg' %}" alt="User" class="reviewer-avatar">
          <div>
            <h4>Sarah Miller</h4>
            <div class="rating-stars">★★★★☆</div>
          </div>
        </div>
        <p class="review-text">"I've tried many alternatives but this one stands out for its ease of use and comprehensive features. Highly recommended!"</p>
        <div class="review-date">Posted on February 28, 2023</div>
      </div>
      
      <!-- Review Card 3 -->
      <div class="review-card">
        <div class="reviewer-info">
          <img src="{% static 'images/hero2.jpg' %}" alt="User" class="reviewer-avatar">
          <div>
            <h4>Michael Chen</h4>
            <div class="rating-stars">★★★★★</div>
          </div>
        </div>
        <p class="review-text">"The value for money is exceptional. I've seen significant improvements in my productivity since switching to this platform."</p>
        <div class="review-date">Posted on January 10, 2023</div>
      </div>
    </div>
    
    <div class="review-cta">
      {% for outfit in outfits %}
      <!-- Link to view reviews for this outfit -->
      <a href="{% url 'outfit_reviews' outfit_id=outfit.id %}" class="btn btn-outline">View All Reviews {{ outfit.reviews_set.count }} </a>
  
      <!-- Link to create a review for this outfit -->
      <a href="{% url 'create_review' outfit_id=outfit.id %}" class="btn btn-primary">Write a Review</a>
      {% endfor %}
    </div>
  </div>
</section>


<!-- Newsletter Section -->
<section class="newsletter-section">
  <div class="container">
    <div class="newsletter-box">
      <div class="newsletter-content">
        <h3>Stay Updated</h3>
        <p>Subscribe to our newsletter for exclusive offers and new arrivals</p>
      </div>
      <form class="newsletter-form">
        <input type="email" placeholder="Your email address" required>
        <button type="submit" class="subscribe-btn">Subscribe</button>
      </form>
    </div>
  </div>
</section>

<!-- Quick View Modal -->
<div class="quick-view-modal">
  <div class="modal-overlay"></div>
  <div class="modal-content">
    <button class="close-modal"><i class="fas fa-times"></i></button>
    <div class="modal-body">
      <!-- Content will be loaded via AJAX -->
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Hero Slider
  const slides = document.querySelectorAll('.hero-slideshow .slide');
  const dotsContainer = document.querySelector('.slide-dots');
  let currentSlide = 0;
  
  // Create dots
  slides.forEach((slide, index) => {
    const dot = document.createElement('span');
    dot.classList.add('dot');
    if(index === 0) dot.classList.add('active');
    dot.addEventListener('click', () => goToSlide(index));
    dotsContainer.appendChild(dot);
  });
  
  function goToSlide(index) {
    slides.forEach(slide => slide.classList.remove('active'));
    document.querySelectorAll('.dot').forEach(dot => dot.classList.remove('active'));
    
    currentSlide = index;
    slides[currentSlide].classList.add('active');
    document.querySelectorAll('.dot')[currentSlide].classList.add('active');
  }
  
  function nextSlide() {
    goToSlide((currentSlide + 1) % slides.length);
  }
  
  // Auto slide every 5 seconds
  setInterval(nextSlide, 5000);
  
  // View Toggle
  const viewOptions = document.querySelectorAll('.view-option');
  const outfitsContainer = document.querySelector('.outfits-container');
  
  viewOptions.forEach(option => {
    option.addEventListener('click', function() {
      viewOptions.forEach(opt => opt.classList.remove('active'));
      this.classList.add('active');
      outfitsContainer.className = 'outfits-container view-' + this.dataset.view;
    });
  });
  
  // Price Range Filter
  const priceRange = document.getElementById('price-range');
  const priceRangeValue = document.querySelector('.price-range-value');
  
  priceRange.addEventListener('input', function() {
    const maxPrice = this.value;
    priceRangeValue.textContent = `Up to Ksh ${maxPrice}`;
    
    document.querySelectorAll('.outfit-card').forEach(card => {
      const price = parseInt(card.dataset.price);
      if(price <= maxPrice) {
        card.style.display = 'block';
      } else {
        card.style.display = 'none';
      }
    });
  });
  
  // Quick View Modal
  const quickViewBtns = document.querySelectorAll('.quick-view-btn');
  const quickViewModal = document.querySelector('.quick-view-modal');
  const closeModal = document.querySelector('.close-modal');
  
  quickViewBtns.forEach(btn => {
    btn.addEventListener('click', function(e) {
      e.preventDefault();
      const outfitId = this.closest('.outfit-card').querySelector('.add-to-cart-btn').dataset.outfitId;
      
      // Simulate loading content
      quickViewModal.querySelector('.modal-body').innerHTML = `
        <div class="loading-spinner">
          <div class="spinner"></div>
        </div>
      `;
      
      quickViewModal.classList.add('active');
      
      // In a real implementation, you would fetch the outfit details via AJAX
      setTimeout(() => {
        quickViewModal.querySelector('.modal-body').innerHTML = `
          <div class="modal-product">
            <div class="modal-product-images">
              <div class="main-image">
                <img src="{% static 'images/placeholder.jpg' %}" alt="Product Image">
              </div>
              <div class="thumbnail-images">
                <div class="thumbnail active"><img src="{% static 'images/placeholder.jpg' %}" alt="Thumbnail"></div>
                <div class="thumbnail"><img src="{% static 'images/placeholder.jpg' %}" alt="Thumbnail"></div>
                <div class="thumbnail"><img src="{% static 'images/placeholder.jpg' %}" alt="Thumbnail"></div>
              </div>
            </div>
            <div class="modal-product-details">
              <h3>${outfitId} - Sample Outfit</h3>
              <div class="price">Ksh 5,999</div>
              <div class="description">
                <p>This is a sample product description. In a real implementation, this would be loaded from the database.</p>
              </div>
              <div class="size-selector">
                <label>Size:</label>
                <div class="size-options">
                  <button class="size-option">S</button>
                  <button class="size-option active">M</button>
                  <button class="size-option">L</button>
                  <button class="size-option">XL</button>
                </div>
              </div>
              <div class="quantity-selector">
                <label>Quantity:</label>
                <div class="quantity-control">
                  <button class="quantity-btn minus">-</button>
                  <input type="number" value="1" min="1">
                  <button class="quantity-btn plus">+</button>
                </div>
              </div>
              <div class="modal-actions">
                <button class="add-to-cart-btn">Add to Cart</button>
                <button class="wishlist-btn"><i class="far fa-heart"></i></button>
              </div>
            </div>
          </div>
        `;
      }, 800);
    });
  });
  
  closeModal.addEventListener('click', () => {
    quickViewModal.classList.remove('active');
  });
  
  quickViewModal.querySelector('.modal-overlay').addEventListener('click', () => {
    quickViewModal.classList.remove('active');
  });
  
  // Animation on Scroll
  const animateElements = document.querySelectorAll('.animate-on-scroll');
  
  function checkAnimation() {
    animateElements.forEach(element => {
      const elementPosition = element.getBoundingClientRect().top;
      const screenPosition = window.innerHeight / 1.2;
      
      if(elementPosition < screenPosition) {
        element.classList.add('animated');
      }
    });
  }
  
  window.addEventListener('scroll', checkAnimation);
  checkAnimation(); // Run once on page load
});

// JavaScript (in your template or static JS file)
function addToCart(outfitId) {
    $.ajax({
        url: '/add-to-cart/',  // Make sure this matches your URL pattern
        method: 'POST',
        data: {
            'outfit_id': outfitId,
            'quantity': 1,  // You can change this if needed
            'csrfmiddlewaretoken': '{{ csrf_token }}'
        },
        success: function(response) {
            if (response.success) {
                alert(response.message);
                // Update cart count in navbar
                $('.cart-count').text(response.cart_count);
            } else {
                alert('Error: ' + response.message);
            }
        },
        error: function(xhr) {
            alert('Request failed: ' + xhr.statusText);
        }
    });
}

// Wishlist Button Handler
document.querySelectorAll('.wishlist-btn').forEach(button => {
  button.addEventListener('click', function() {
    const outfitId = this.dataset.outfitId;
    
    fetch('/toggle-wishlist/', {
      method: 'POST',
      headers: {
        'X-CSRFToken': '{{ csrf_token }}',
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      body: `outfit_id=${outfitId}`
    })
    .then(response => response.json())
    .then(data => {
      if(data.success) {
        this.innerHTML = data.on_wishlist ? '❤️' : '♡';
        alert(data.on_wishlist ? 'Added to wishlist!' : 'Removed');
      }
    });
  });
});

// Compare Button Handler
document.querySelectorAll('.compare-btn').forEach(button => {
  button.addEventListener('click', function() {
    const outfitId = this.dataset.outfitId;
    
    fetch('/add-to-compare/', {
      method: 'POST',
      headers: {
        'X-CSRFToken': '{{ csrf_token }}',
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      body: `outfit_id=${outfitId}`
    })
    .then(response => response.json())
    .then(data => {
      alert(data.message);
      if(data.success) {
        // Update compare counter
        const counter = document.querySelector('.compare-counter');
        if(counter) {
          const current = parseInt(counter.textContent);
          counter.textContent = data.added ? current + 1 : current - 1;
        }
      }
    });
  });
});

// Cart Functions
function addToCart(outfitId, quantity = 1) {
  fetch('/add-to-cart/', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRFToken': getCookie('csrftoken'),
    },
    body: JSON.stringify({
      outfit_id: outfitId,
      quantity: quantity
    })
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      showNotification('Item added to cart!', 'success');
      updateCartCount(data.cart_count);
    } else {
      showNotification(data.message || 'Error adding to cart', 'error');
    }
  })
  .catch(error => {
    console.error('Error:', error);
    showNotification('Network error. Please try again.', 'error');
  });
}

// Wishlist Functions
function toggleWishlist(outfitId, button) {
  fetch('/toggle-wishlist/', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRFToken': getCookie('csrftoken'),
    },
    body: JSON.stringify({
      outfit_id: outfitId
    })
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      const icon = button.querySelector('i');
      if (data.on_wishlist) {
        icon.classList.replace('far', 'fas');
        showNotification('Added to wishlist!', 'success');
      } else {
        icon.classList.replace('fas', 'far');
        showNotification('Removed from wishlist', 'info');
      }
    }
  })
  .catch(error => {
    console.error('Error:', error);
    showNotification('Error updating wishlist', 'error');
  });
}

// Compare Functions
function addToCompare(outfitId, button) {
  fetch('/add-to-compare/', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRFToken': getCookie('csrftoken'),
    },
    body: JSON.stringify({
      outfit_id: outfitId
    })
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      button.classList.toggle('active');
      showNotification(
        data.message || (button.classList.contains('active') ? 
          'Added to compare' : 'Removed from compare'), 
        'success'
      );
    }
  })
  .catch(error => {
    console.error('Error:', error);
    showNotification('Error comparing items', 'error');
  });
}

// Helper Functions
function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== '') {
    const cookies = document.cookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
      const cookie = cookies[i].trim();
      if (cookie.substring(0, name.length + 1) === (name + '=')) {
        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
        break;
      }
    }
  }
  return cookieValue;
}

function showNotification(message, type) {
  // Create notification element
  const notification = document.createElement('div');
  notification.className = `notification ${type}`;
  notification.innerHTML = `
    ${message}
    <span class="close-notification">&times;</span>
    <div class="notification-progress"></div>
  `;
  
  // Add to container
  const container = document.querySelector('.notification-container') || createNotificationContainer();
  container.appendChild(notification);
  
  // Auto-remove after 5 seconds
  setTimeout(() => {
    notification.classList.add('fade-out');
    setTimeout(() => notification.remove(), 300);
  }, 5000);
  
  // Close button
  notification.querySelector('.close-notification').addEventListener('click', () => {
    notification.remove();
  });
}

function createNotificationContainer() {
  const container = document.createElement('div');
  container.className = 'notification-container';
  document.body.appendChild(container);
  return container;
}

function updateCartCount(count) {
  const cartCountElements = document.querySelectorAll('.cart-count');
  cartCountElements.forEach(el => {
    el.textContent = count;
  });
}


</script>
{% endblock %}